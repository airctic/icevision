



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for IceVision.">
      
      
        <link rel="canonical" href="https://airctic.com/0.5.2/wandb_masks/">
      
      
        <meta name="author" content="Lucas Goulart Vazquez, Farid Hassainia, and Contributors">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.14">
    
    
      
        <title>Wandb masks - IceVision</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.d3202873.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.ff0a5ce4.min.css">
      
      
        
        
        <meta name="theme-color" content="#2094f3">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
      <link rel="manifest" href="../manifest.webmanifest" crossorigin="use-credentials">
    
    
      <link rel="stylesheet" href="../css/termynal.css">
    
      <link rel="stylesheet" href="../css/custom.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-use-mask-rcnn" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://airctic.com/0.5.2" title="IceVision" class="md-header-nav__button md-logo" aria-label="IceVision">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            IceVision
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Wandb masks
            
          </span>
        </div>
      
    </div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/airctic/IceVision" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://airctic.com/0.5.2" title="IceVision" class="md-nav__button md-logo" aria-label="IceVision">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    IceVision
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/airctic/IceVision" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../install/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Tutorials
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../getting_started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../quickstart/" title="Quickstart using EfficientDet" class="md-nav__link">
      Quickstart using EfficientDet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../retinanet/" title="Quickstart using RetinaNet" class="md-nav__link">
      Quickstart using RetinaNet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../custom_parser/" title="Custom Parser" class="md-nav__link">
      Custom Parser
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../inference/" title="Inference" class="md-nav__link">
      Inference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mask_rcnn_pennfudan/" title="Mask RCNN" class="md-nav__link">
      Mask RCNN
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../efficientdet_pets/" title="EffecientDet" class="md-nav__link">
      EffecientDet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dataset_voc_nb/" title="Training a VOC dataset" class="md-nav__link">
      Training a VOC dataset
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../wandb_efficientdet/" title="Model Tracking Using Wandb" class="md-nav__link">
      Model Tracking Using Wandb
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../negative_samples/" title="How to use negative samples" class="md-nav__link">
      How to use negative samples
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../voc_predefined_splits/" title="Fixed Splitter" class="md-nav__link">
      Fixed Splitter
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Examples
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Examples" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../examples/getting_started_exp/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../examples/quickstart_exp/" title="Quickstart" class="md-nav__link">
      Quickstart
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../examples/inference_exp/" title="Inference" class="md-nav__link">
      Inference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../examples/efficientdet_pets_exp/" title="EffecientDet" class="md-nav__link">
      EffecientDet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../examples/mask_rcnn_pennfudan_exp/" title="Mask RCNN" class="md-nav__link">
      Mask RCNN
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../examples/dataset_voc_exp/" title="Training a VOC dataset" class="md-nav__link">
      Training a VOC dataset
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../examples/backbones_faster_rcnn/" title="Backbones - Faster RCNN" class="md-nav__link">
      Backbones - Faster RCNN
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Transforms
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Transforms" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Transforms
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../albumentations/" title="Albumentations" class="md-nav__link">
      Albumentations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Models
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Models" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Models
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../model_efficientdet/" title="EffecientDet" class="md-nav__link">
      EffecientDet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../model_faster_rcnn/" title="Faster RCNN" class="md-nav__link">
      Faster RCNN
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../model_comparison/" title="Models Comparison" class="md-nav__link">
      Models Comparison
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Backbones
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Backbones" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        Backbones
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../backbones_effecientdet/" title="EffecientDet" class="md-nav__link">
      EffecientDet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../backbones_faster_mask_rcnn/" title="Faster/Mask RCNN" class="md-nav__link">
      Faster/Mask RCNN
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Deployment
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Deployment" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon"></span>
        Deployment
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../deployment/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-2" type="checkbox" id="nav-8-2">
    
    <label class="md-nav__link" for="nav-8-2">
      Gradio
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Gradio" data-md-level="2">
      <label class="md-nav__title" for="nav-8-2">
        <span class="md-nav__icon md-icon"></span>
        Gradio
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../IceApp_coco/" title="COCO" class="md-nav__link">
      COCO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../IceApp_pets/" title="PETS" class="md-nav__link">
      PETS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../IceApp_masks/" title="Masks" class="md-nav__link">
      Masks
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      API Documentation
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="API Documentation" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        <span class="md-nav__icon md-icon"></span>
        API Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../parser/" title="Parser" class="md-nav__link">
      Parser
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dataset/" title="Dataset" class="md-nav__link">
      Dataset
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9-3" type="checkbox" id="nav-9-3">
    
    <label class="md-nav__link" for="nav-9-3">
      Transforms
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Transforms" data-md-level="2">
      <label class="md-nav__title" for="nav-9-3">
        <span class="md-nav__icon md-icon"></span>
        Transforms
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../albumentations_tfms/" title="Albumentations" class="md-nav__link">
      Albumentations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9-4" type="checkbox" id="nav-9-4">
    
    <label class="md-nav__link" for="nav-9-4">
      Models
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Models" data-md-level="2">
      <label class="md-nav__title" for="nav-9-4">
        <span class="md-nav__icon md-icon"></span>
        Models
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9-4-1" type="checkbox" id="nav-9-4-1">
    
    <label class="md-nav__link" for="nav-9-4-1">
      Faster RCNN
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Faster RCNN" data-md-level="3">
      <label class="md-nav__title" for="nav-9-4-1">
        <span class="md-nav__icon md-icon"></span>
        Faster RCNN
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../faster_rcnn/" title="common" class="md-nav__link">
      common
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../faster_rcnn_fastai/" title="fastai" class="md-nav__link">
      fastai
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../faster_rcnn_lightning/" title="lightning" class="md-nav__link">
      lightning
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9-4-2" type="checkbox" id="nav-9-4-2">
    
    <label class="md-nav__link" for="nav-9-4-2">
      Mask RCNN
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Mask RCNN" data-md-level="3">
      <label class="md-nav__title" for="nav-9-4-2">
        <span class="md-nav__icon md-icon"></span>
        Mask RCNN
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../mask_rcnn/" title="common" class="md-nav__link">
      common
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mask_rcnn_fastai/" title="fastai" class="md-nav__link">
      fastai
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../mask_rcnn_lightning/" title="lightning" class="md-nav__link">
      lightning
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9-4-3" type="checkbox" id="nav-9-4-3">
    
    <label class="md-nav__link" for="nav-9-4-3">
      EfficientDet
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="EfficientDet" data-md-level="3">
      <label class="md-nav__title" for="nav-9-4-3">
        <span class="md-nav__icon md-icon"></span>
        EfficientDet
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../efficientdet/" title="common" class="md-nav__link">
      common
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../efficientdet_fastai/" title="fastai" class="md-nav__link">
      fastai
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../efficientdet_lightning/" title="lightning" class="md-nav__link">
      lightning
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../data_splits/" title="Data Splitters" class="md-nav__link">
      Data Splitters
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../how-to/" title="How-To" class="md-nav__link">
      How-To
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../contributing/" title="Contributing Guide" class="md-nav__link">
      Contributing Guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../readme_mkdocs/" title="Generating Docs" class="md-nav__link">
      Generating Docs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      Preferences
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Preferences" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        <span class="md-nav__icon md-icon"></span>
        Preferences
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../changing_the_colors/" title="Changing the colors" class="md-nav__link">
      Changing the colors
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../code_of_conduct/" title="Code of Conduct" class="md-nav__link">
      Code of Conduct
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../about/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installing-icevision" class="md-nav__link">
    Installing IceVision
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#imports" class="md-nav__link">
    Imports
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data" class="md-nav__link">
    Data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metrics" class="md-nav__link">
    Metrics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model" class="md-nav__link">
    Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training-fastai" class="md-nav__link">
    Training - fastai
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visualize-predictions" class="md-nav__link">
    Visualize predictions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#happy-learning" class="md-nav__link">
    Happy Learning!
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <p><a href="https://colab.research.google.com/github/airctic/icevision/blob/master/notebooks/wandb_masks.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></p>
<div class="highlight"><pre><span></span><code><span class="err">!</span><span class="n">nvidia</span><span class="o">-</span><span class="n">smi</span>
</code></pre></div>
<h1 id="how-to-use-mask-rcnn">How to use Mask RCNN</h1>
<h2 id="installing-icevision">Installing IceVision</h2>
<p>We ussually install IceVision with <code>[all]</code>, but we can also use <code>[inference]</code> to install only the packages that inference methods depend on.</p>
<div class="highlight"><pre><span></span><code><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">icevision</span><span class="p">[</span><span class="nb">all</span><span class="p">]</span> <span class="n">icedata</span>
</code></pre></div>
<h2 id="imports">Imports</h2>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">icevision.all</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fastai.callback.wandb</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fastai.callback.tracker</span> <span class="kn">import</span> <span class="n">SaveModelCallback</span>
</code></pre></div>
<h2 id="data">Data</h2>
<p>We'll be using the <a href="https://www.cis.upenn.edu/~jshi/ped_html/">Penn-Fudan</a> dataset, which is already available under <code>datasets</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">data_dir</span> <span class="o">=</span> <span class="n">icedata</span><span class="o">.</span><span class="n">pennfudan</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="n">class_map</span> <span class="o">=</span> <span class="n">icedata</span><span class="o">.</span><span class="n">pennfudan</span><span class="o">.</span><span class="n">class_map</span><span class="p">()</span>
</code></pre></div>
<div class="k-default-codeblock">
<div class="highlight"><pre><span></span><code>HBox(children=(HTML(value=&#39;&#39;), FloatProgress(value=0.0, max=53723336.0), HTML(value=&#39;&#39;)))
</code></pre></div>
</div>
<p>As usual, let's create the parser and perfom a random data split.</p>
<div class="highlight"><pre><span></span><code><span class="n">parser</span> <span class="o">=</span> <span class="n">icedata</span><span class="o">.</span><span class="n">pennfudan</span><span class="o">.</span><span class="n">parser</span><span class="p">(</span><span class="n">data_dir</span><span class="p">)</span>

<span class="n">train_records</span><span class="p">,</span> <span class="n">valid_records</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
</code></pre></div>
<div class="k-default-codeblock">
<div class="highlight"><pre><span></span><code>HBox(children=(HTML(value=&#39;&#39;), FloatProgress(value=0.0, max=170.0), HTML(value=&#39;&#39;)))

[1m[1mINFO    [0m[1m[0m - [1m[34m[1mAutofixing records[0m[1m[34m[0m[1m[0m | [36micevision.parsers.parser[0m:[36mparse[0m:[36m124[0m
</code></pre></div>
</div>

<div class="highlight"><pre><span></span><code><span class="n">train_records</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;masks&quot;</span><span class="p">]</span>
</code></pre></div>
<div class="k-default-codeblock">
<div class="highlight"><pre><span></span><code>&lt;EncodedRLEs with 1 objects&gt;
</code></pre></div>
</div>
<p>Let's use the usual <code>aug_tfms</code> for training transforms with two small modifications:
- Decrease the rotation limit from 45 to 10.
- Use a more aggresive crop function.</p>
<div class="highlight"><pre><span></span><code><span class="n">shift_scale_rotate</span> <span class="o">=</span> <span class="n">tfms</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">ShiftScaleRotate</span><span class="p">(</span><span class="n">rotate_limit</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">crop_fn</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">tfms</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">RandomSizedCrop</span><span class="p">,</span> <span class="n">min_max_height</span><span class="o">=</span><span class="p">(</span><span class="mi">384</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="mi">384</span><span class="p">),</span> <span class="n">p</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
<span class="n">train_tfms</span> <span class="o">=</span> <span class="n">tfms</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">Adapter</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="o">*</span><span class="n">tfms</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">aug_tfms</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">384</span><span class="p">,</span> <span class="n">presize</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">shift_scale_rotate</span><span class="o">=</span><span class="n">shift_scale_rotate</span><span class="p">,</span> <span class="n">crop_fn</span><span class="o">=</span><span class="n">crop_fn</span><span class="p">),</span>
        <span class="n">tfms</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(),</span>
    <span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
<p>And for validation transforms, the simple <code>resize_and_pad</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">valid_tfms</span> <span class="o">=</span> <span class="n">tfms</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">Adapter</span><span class="p">([</span><span class="o">*</span><span class="n">tfms</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">resize_and_pad</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">348</span><span class="p">),</span> <span class="n">tfms</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">Normalize</span><span class="p">()])</span>
</code></pre></div>
<p>Now we can create the <code>Dataset</code> and take a look on how the images look after the transforms.</p>
<div class="highlight"><pre><span></span><code><span class="n">train_ds</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">train_records</span><span class="p">,</span> <span class="n">train_tfms</span><span class="p">)</span>
<span class="n">valid_ds</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">valid_records</span><span class="p">,</span> <span class="n">valid_tfms</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">train_ds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)]</span>
<span class="n">show_samples</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">denormalize_fn</span><span class="o">=</span><span class="n">denormalize_imagenet</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">display_label</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../images/wandb_masks/wandb_masks_20_0.png" /></p>
<p>Now we're ready to create the DataLoaders:</p>
<div class="highlight"><pre><span></span><code><span class="n">train_dl</span> <span class="o">=</span> <span class="n">mask_rcnn</span><span class="o">.</span><span class="n">train_dl</span><span class="p">(</span><span class="n">train_ds</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">valid_dl</span> <span class="o">=</span> <span class="n">mask_rcnn</span><span class="o">.</span><span class="n">valid_dl</span><span class="p">(</span><span class="n">valid_ds</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div>
<h2 id="metrics">Metrics</h2>
<p>Metrics are a work in progress for Mask RCNN.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># metrics = [COCOMetric(COCOMetricType.mask)]</span>
</code></pre></div>
<h2 id="model">Model</h2>
<p>Similarly to <code>faster_rcnn</code>, we just need the <code>num_classes</code> to create a Mask RCNN model.</p>
<div class="highlight"><pre><span></span><code><span class="n">model</span> <span class="o">=</span> <span class="n">mask_rcnn</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">num_classes</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">class_map</span><span class="p">))</span>
</code></pre></div>
<div class="k-default-codeblock">
<div class="highlight"><pre><span></span><code>Downloading: &quot;https://download.pytorch.org/models/maskrcnn_resnet50_fpn_coco-bf2d0c1e.pth&quot; to /root/.cache/torch/hub/checkpoints/maskrcnn_resnet50_fpn_coco-bf2d0c1e.pth

HBox(children=(HTML(value=&#39;&#39;), FloatProgress(value=0.0, max=178090079.0), HTML(value=&#39;&#39;)))
</code></pre></div>
</div>

<div class="highlight"><pre><span></span><code><span class="n">wandb</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="s2">&quot;icevision-masks&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mask-rcnn-resnet50-2&quot;</span><span class="p">,</span> <span class="n">reinit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p>Finishing last run (ID:eu733uxj) before initializing another...</p>
<p><br/>Waiting for W&amp;B process to finish, PID 159<br/>Program ended successfully.</p>
<div class="k-default-codeblock">
<div class="highlight"><pre><span></span><code>VBox(children=(Label(value=&#39; 347.34MB of 347.34MB uploaded (0.00MB deduped)\r&#39;), FloatProgress(value=1.0, max=â€¦
</code></pre></div>
</div>
<p>Find user logs for this run at: <code>/content/wandb/run-20201112_010811-eu733uxj/logs/debug.log</code></p>
<p>Find internal logs for this run at: <code>/content/wandb/run-20201112_010811-eu733uxj/logs/debug-internal.log</code></p>
<h3>Run summary:</h3>
<p><br/><style>
    table.wandb td:nth-child(1) { padding: 0 10px; text-align: right }
    </style></p>
<table class="wandb">
<tr><td>epoch</td><td>12</td></tr><tr><td>train_loss</td><td>0.38875</td></tr><tr><td>raw_loss</td><td>0.38006</td></tr><tr><td>wd_0</td><td>0.01</td></tr><tr><td>sqr_mom_0</td><td>0.99</td></tr><tr><td>lr_0</td><td>0.0</td></tr><tr><td>mom_0</td><td>0.94994</td></tr><tr><td>eps_0</td><td>1e-05</td></tr><tr><td>wd_1</td><td>0.01</td></tr><tr><td>sqr_mom_1</td><td>0.99</td></tr><tr><td>lr_1</td><td>0.0</td></tr><tr><td>mom_1</td><td>0.94994</td></tr><tr><td>eps_1</td><td>1e-05</td></tr><tr><td>wd_2</td><td>0.01</td></tr><tr><td>sqr_mom_2</td><td>0.99</td></tr><tr><td>lr_2</td><td>0.0</td></tr><tr><td>mom_2</td><td>0.94994</td></tr><tr><td>eps_2</td><td>1e-05</td></tr><tr><td>wd_3</td><td>0.01</td></tr><tr><td>sqr_mom_3</td><td>0.99</td></tr><tr><td>lr_3</td><td>0.0</td></tr><tr><td>mom_3</td><td>0.94994</td></tr><tr><td>eps_3</td><td>1e-05</td></tr><tr><td>wd_4</td><td>0.01</td></tr><tr><td>sqr_mom_4</td><td>0.99</td></tr><tr><td>lr_4</td><td>0.0</td></tr><tr><td>mom_4</td><td>0.94994</td></tr><tr><td>eps_4</td><td>1e-05</td></tr><tr><td>wd_5</td><td>0.01</td></tr><tr><td>sqr_mom_5</td><td>0.99</td></tr><tr><td>lr_5</td><td>0.0</td></tr><tr><td>mom_5</td><td>0.94994</td></tr><tr><td>eps_5</td><td>1e-05</td></tr><tr><td>wd_6</td><td>0.01</td></tr><tr><td>sqr_mom_6</td><td>0.99</td></tr><tr><td>lr_6</td><td>0.0</td></tr><tr><td>mom_6</td><td>0.94994</td></tr><tr><td>eps_6</td><td>1e-05</td></tr><tr><td>wd_7</td><td>0.01</td></tr><tr><td>sqr_mom_7</td><td>0.99</td></tr><tr><td>lr_7</td><td>0.0</td></tr><tr><td>mom_7</td><td>0.94994</td></tr><tr><td>eps_7</td><td>1e-05</td></tr><tr><td>_step</td><td>109</td></tr><tr><td>_runtime</td><td>5124</td></tr><tr><td>_timestamp</td><td>1605148415</td></tr><tr><td>valid_loss</td><td>0.31662</td></tr></table>

<h3>Run history:</h3>
<p><br/><style>
    table.wandb td:nth-child(1) { padding: 0 10px; text-align: right }
    </style></p>
<table class="wandb">
<tr><td>epoch</td><td>â–â–â–â–‚â–‚â–‚â–‚â–‚â–‚â–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–„â–„â–„â–„â–„â–…â–…â–…â–…â–…â–…â–†â–†â–†â–†â–†â–‡â–‡â–‡â–‡â–‡â–‡â–ˆâ–ˆâ–ˆ</td></tr><tr><td>train_loss</td><td>â–ˆâ–‡â–†â–…â–„â–„â–ƒâ–‚â–‚â–‚â–â–‚â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>raw_loss</td><td>â–ˆâ–†â–ƒâ–ƒâ–‚â–‚â–…â–‚â–â–â–â–‚â–â–â–â–â–â–‚â–â–â–‚â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–‚â–â–â–â–</td></tr><tr><td>wd_0</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>sqr_mom_0</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>lr_0</td><td>â–â–â–ƒâ–„â–…â–‡â–ˆâ–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>mom_0</td><td>â–ˆâ–ˆâ–‡â–…â–„â–‚â–â–ˆâ–ˆâ–‡â–†â–…â–„â–ƒâ–‚â–â–â–â–â–â–â–‚â–‚â–‚â–ƒâ–ƒâ–„â–„â–„â–…â–…â–†â–†â–‡â–‡â–‡â–ˆâ–ˆâ–ˆâ–ˆ</td></tr><tr><td>eps_0</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>wd_1</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>sqr_mom_1</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>lr_1</td><td>â–â–â–ƒâ–„â–…â–‡â–ˆâ–â–â–â–â–â–â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>mom_1</td><td>â–ˆâ–ˆâ–‡â–…â–„â–‚â–â–ˆâ–ˆâ–‡â–†â–…â–„â–ƒâ–‚â–â–â–â–â–â–â–‚â–‚â–‚â–ƒâ–ƒâ–„â–„â–„â–…â–…â–†â–†â–‡â–‡â–‡â–ˆâ–ˆâ–ˆâ–ˆ</td></tr><tr><td>eps_1</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>wd_2</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>sqr_mom_2</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>lr_2</td><td>â–â–â–ƒâ–„â–…â–‡â–ˆâ–â–â–â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–‚â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>mom_2</td><td>â–ˆâ–ˆâ–‡â–…â–„â–‚â–â–ˆâ–ˆâ–‡â–†â–…â–„â–ƒâ–‚â–â–â–â–â–â–â–‚â–‚â–‚â–ƒâ–ƒâ–„â–„â–„â–…â–…â–†â–†â–‡â–‡â–‡â–ˆâ–ˆâ–ˆâ–ˆ</td></tr><tr><td>eps_2</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>wd_3</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>sqr_mom_3</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>lr_3</td><td>â–â–â–ƒâ–„â–…â–‡â–ˆâ–‚â–‚â–‚â–‚â–‚â–ƒâ–ƒâ–ƒâ–ƒâ–„â–„â–„â–„â–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–‚â–‚â–‚â–‚â–‚â–‚â–â–â–â–â–â–â–</td></tr><tr><td>mom_3</td><td>â–ˆâ–ˆâ–‡â–…â–„â–‚â–â–ˆâ–ˆâ–‡â–†â–…â–„â–ƒâ–‚â–â–â–â–â–â–â–‚â–‚â–‚â–ƒâ–ƒâ–„â–„â–„â–…â–…â–†â–†â–‡â–‡â–‡â–ˆâ–ˆâ–ˆâ–ˆ</td></tr><tr><td>eps_3</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>wd_4</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>sqr_mom_4</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>lr_4</td><td>â–â–â–ƒâ–„â–…â–‡â–ˆâ–‚â–‚â–‚â–ƒâ–„â–„â–…â–…â–†â–†â–†â–†â–†â–†â–†â–…â–…â–…â–…â–„â–„â–„â–ƒâ–ƒâ–‚â–‚â–‚â–‚â–â–â–â–â–</td></tr><tr><td>mom_4</td><td>â–ˆâ–ˆâ–‡â–…â–„â–‚â–â–ˆâ–ˆâ–‡â–†â–…â–„â–ƒâ–‚â–â–â–â–â–â–â–‚â–‚â–‚â–ƒâ–ƒâ–„â–„â–„â–…â–…â–†â–†â–‡â–‡â–‡â–ˆâ–ˆâ–ˆâ–ˆ</td></tr><tr><td>eps_4</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>wd_5</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>sqr_mom_5</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>lr_5</td><td>â–â–â–‚â–ƒâ–„â–…â–†â–‚â–ƒâ–ƒâ–„â–…â–…â–†â–‡â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‡â–‡â–‡â–†â–†â–…â–…â–…â–„â–„â–ƒâ–ƒâ–‚â–‚â–‚â–â–â–â–</td></tr><tr><td>mom_5</td><td>â–ˆâ–ˆâ–‡â–…â–„â–‚â–â–ˆâ–ˆâ–‡â–†â–…â–„â–ƒâ–‚â–â–â–â–â–â–â–‚â–‚â–‚â–ƒâ–ƒâ–„â–„â–„â–…â–…â–†â–†â–‡â–‡â–‡â–ˆâ–ˆâ–ˆâ–ˆ</td></tr><tr><td>eps_5</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>wd_6</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>sqr_mom_6</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>lr_6</td><td>â–â–â–‚â–‚â–ƒâ–ƒâ–„â–‚â–ƒâ–ƒâ–„â–…â–…â–†â–‡â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‡â–‡â–‡â–†â–†â–…â–…â–…â–„â–„â–ƒâ–ƒâ–‚â–‚â–‚â–â–â–â–</td></tr><tr><td>mom_6</td><td>â–ˆâ–ˆâ–‡â–…â–„â–‚â–â–ˆâ–ˆâ–‡â–†â–…â–„â–ƒâ–‚â–â–â–â–â–â–â–‚â–‚â–‚â–ƒâ–ƒâ–„â–„â–„â–…â–…â–†â–†â–‡â–‡â–‡â–ˆâ–ˆâ–ˆâ–ˆ</td></tr><tr><td>eps_6</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>wd_7</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>sqr_mom_7</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>lr_7</td><td>â–â–â–ƒâ–„â–…â–‡â–ˆâ–‚â–‚â–‚â–‚â–ƒâ–ƒâ–„â–„â–„â–…â–…â–…â–„â–„â–„â–„â–„â–„â–„â–ƒâ–ƒâ–ƒâ–ƒâ–‚â–‚â–‚â–‚â–â–â–â–â–â–</td></tr><tr><td>mom_7</td><td>â–ˆâ–ˆâ–‡â–…â–„â–‚â–â–ˆâ–ˆâ–‡â–†â–…â–„â–ƒâ–‚â–â–â–â–â–â–â–‚â–‚â–‚â–ƒâ–ƒâ–„â–„â–„â–…â–…â–†â–†â–‡â–‡â–‡â–ˆâ–ˆâ–ˆâ–ˆ</td></tr><tr><td>eps_7</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–</td></tr><tr><td>_step</td><td>â–â–â–â–‚â–‚â–‚â–‚â–‚â–‚â–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–„â–„â–„â–„â–„â–„â–…â–…â–…â–…â–…â–…â–†â–†â–†â–†â–†â–‡â–‡â–‡â–‡â–‡â–‡â–ˆâ–ˆâ–ˆ</td></tr><tr><td>_runtime</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–ˆ</td></tr><tr><td>_timestamp</td><td>â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–ˆ</td></tr><tr><td>valid_loss</td><td>â–ˆâ–…â–ƒâ–‚â–‚â–‚â–â–â–â–â–â–</td></tr></table>
<p>Synced 5 W&amp;B file(s), 340 media file(s), 2 artifact file(s) and 0 other file(s)</p>
<p><br/>Synced <strong style="color:#cdcd00">mask-rcnn-resnet50-1</strong>: <a href="https://wandb.ai/ai-fast-track/icevision-masks/runs/eu733uxj" target="_blank">https://wandb.ai/ai-fast-track/icevision-masks/runs/eu733uxj</a><br/></p>
<p>...Successfully finished last run (ID:eu733uxj). Initializing new run:<br/><br/></p>
<p>Tracking run with wandb version 0.10.10<br/>
Syncing run <strong style="color:#cdcd00">mask-rcnn-resnet50-2</strong> to <a href="https://wandb.ai" target="_blank">Weights &amp; Biases</a> <a href="https://docs.wandb.com/integrations/jupyter.html" target="_blank">(Documentation)</a>.<br/>
Project page: <a href="https://wandb.ai/ai-fast-track/icevision-masks" target="_blank">https://wandb.ai/ai-fast-track/icevision-masks</a><br/>
Run page: <a href="https://wandb.ai/ai-fast-track/icevision-masks/runs/1m79qv7k" target="_blank">https://wandb.ai/ai-fast-track/icevision-masks/runs/1m79qv7k</a><br/>
Run data is saved locally in <code>/content/wandb/run-20201112_023439-1m79qv7k</code><br/><br/></p>
<p><br/><h1>Run(1m79qv7k)</h1></p>
<p></p>
<iframe src="https://wandb.ai/ai-fast-track/icevision-masks/runs/1m79qv7k" style="border:none;width:100%;height:400px"></iframe>

<h2 id="training-fastai">Training - fastai</h2>
<p>We just need to create the learner and fine-tune.</p>
<div class="admonition info">
<p class="admonition-title">Optional</p>
<p>You can use <code>learn.lr_find()</code> for finding a good learning rate.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="n">learn</span> <span class="o">=</span> <span class="n">mask_rcnn</span><span class="o">.</span><span class="n">fastai</span><span class="o">.</span><span class="n">learner</span><span class="p">(</span><span class="n">dls</span><span class="o">=</span><span class="p">[</span><span class="n">train_dl</span><span class="p">,</span> <span class="n">valid_dl</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="p">[</span><span class="n">WandbCallback</span><span class="p">(</span><span class="n">log_dataset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log_model</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">SaveModelCallback</span><span class="p">()])</span>
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><span class="c1"># !cp /root/.cache/torch/hub/checkpoints/maskrcnn_resnet50_fpn_coco-bf2d0c1e.pth models/</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># !ls models</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># !rm models/model.pth</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">learn</span><span class="o">.</span><span class="n">fine_tune</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">5e-4</span><span class="p">,</span> <span class="n">freeze_epochs</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></p>
<div class="k-default-codeblock">
<div class="highlight"><pre><span></span><code>[33m[1m[1mWARNING [0m[33m[1m[0m - [33m[1mWandb quickfix implemented, for more info check issue #527[0m | [36micevision.models.rcnn.fastai.learner[0m:[36mrcnn_learner[0m:[36m39[0m

Could not gather input dimensions
WandbCallback could not retrieve the dataset path, please provide it explicitly to &quot;log_dataset&quot;
WandbCallback was not able to prepare a DataLoader for logging prediction samples -&gt; &#39;Dataset&#39; object has no attribute &#39;items&#39;
</code></pre></div>
</div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.843482</td>
      <td>0.828755</td>
      <td>00:13</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1.284275</td>
      <td>0.588426</td>
      <td>00:10</td>
    </tr>
  </tbody>
</table>

<div class="k-default-codeblock">
<div class="highlight"><pre><span></span><code>Better model found at epoch 0 with valid_loss value: 0.828754723072052.
Better model found at epoch 1 with valid_loss value: 0.5884255766868591.

/usr/local/lib/python3.6/dist-packages/fastai/learner.py:54: UserWarning: Saved filed doesn&#39;t contain an optimizer state.
  elif with_opt: warn(&quot;Saved filed doesn&#39;t contain an optimizer state.&quot;)
[34m[1mwandb[0m: Adding directory to artifact (/tmp/tmpgcqxjvrk)... Done. 0.4s

Could not gather input dimensions
</code></pre></div>
</div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.591160</td>
      <td>0.429428</td>
      <td>00:14</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.529282</td>
      <td>0.374389</td>
      <td>00:12</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.500065</td>
      <td>0.406371</td>
      <td>00:10</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.480722</td>
      <td>0.368016</td>
      <td>00:11</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.465826</td>
      <td>0.340654</td>
      <td>00:11</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.446898</td>
      <td>0.317662</td>
      <td>00:12</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.429577</td>
      <td>0.323954</td>
      <td>00:11</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.417124</td>
      <td>0.314693</td>
      <td>00:11</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.405281</td>
      <td>0.313216</td>
      <td>00:11</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.388749</td>
      <td>0.316623</td>
      <td>00:11</td>
    </tr>
  </tbody>
</table>

<div class="k-default-codeblock">
<div class="highlight"><pre><span></span><code>Exception ignored in: &lt;finalize object at 0x7fdfac6a4190; dead&gt;
Traceback (most recent call last):
  File &quot;/usr/lib/python3.6/weakref.py&quot;, line 548, in __call__
    return info.func(*info.args, **(info.kwargs or {}))
  File &quot;/usr/lib/python3.6/tempfile.py&quot;, line 938, in _cleanup
    _rmtree(name)
  File &quot;/usr/lib/python3.6/shutil.py&quot;, line 477, in rmtree
    onerror(os.lstat, path, sys.exc_info())
  File &quot;/usr/lib/python3.6/shutil.py&quot;, line 475, in rmtree
    orig_st = os.lstat(path)
FileNotFoundError: [Errno 2] No such file or directory: &#39;/tmp/tmpgcqxjvrk&#39;

Better model found at epoch 0 with valid_loss value: 0.42942774295806885.
Better model found at epoch 1 with valid_loss value: 0.37438860535621643.
Better model found at epoch 3 with valid_loss value: 0.36801600456237793.
Better model found at epoch 4 with valid_loss value: 0.3406542241573334.
Better model found at epoch 5 with valid_loss value: 0.31766191124916077.
Better model found at epoch 7 with valid_loss value: 0.314692884683609.
Better model found at epoch 8 with valid_loss value: 0.3132163882255554.

[34m[1mwandb[0m: Adding directory to artifact (/tmp/tmpf05n03p9)... Done. 0.4s
</code></pre></div>
</div>
<h2 id="visualize-predictions">Visualize predictions</h2>
<p>Let's grab some images from <code>valid_ds</code> to visualize. For more info on how to do inference, check the <a href="https://airctic.github.io/icevision/inference/">inference tutorial</a>.</p>
<div class="highlight"><pre><span></span><code><span class="n">mask_rcnn</span><span class="o">.</span><span class="n">show_results</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">valid_ds</span><span class="p">,</span> <span class="n">class_map</span><span class="o">=</span><span class="n">class_map</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../images/wandb_masks/wandb_masks_40_0.png" /></p>
<div class="highlight"><pre><span></span><code><span class="n">infer_dl</span> <span class="o">=</span> <span class="n">mask_rcnn</span><span class="o">.</span><span class="n">infer_dl</span><span class="p">(</span><span class="n">valid_ds</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">samples</span><span class="p">,</span> <span class="n">preds</span> <span class="o">=</span> <span class="n">mask_rcnn</span><span class="o">.</span><span class="n">predict_dl</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">infer_dl</span><span class="o">=</span><span class="n">infer_dl</span><span class="p">)</span>
</code></pre></div>
<div class="k-default-codeblock">
<div class="highlight"><pre><span></span><code>HBox(children=(HTML(value=&#39;&#39;), FloatProgress(value=0.0, max=5.0), HTML(value=&#39;&#39;)))
</code></pre></div>
</div>

<div class="highlight"><pre><span></span><code><span class="n">wandb_images</span> <span class="o">=</span> <span class="n">wandb_img_preds</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">class_map</span><span class="p">,</span> <span class="n">add_ground_truth</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">len</span><span class="p">(</span><span class="n">wandb_images</span><span class="p">)</span>
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><span class="n">wandb</span><span class="o">.</span><span class="n">log</span><span class="p">({</span><span class="s2">&quot;Predicted images&quot;</span><span class="p">:</span> <span class="n">wandb_images</span><span class="p">})</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">wandb</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</code></pre></div></p>
<div class="k-default-codeblock">
<div class="highlight"><pre><span></span><code>34
</code></pre></div>
</div>
<h2 id="happy-learning">Happy Learning!</h2>
<p>If you need any assistance, feel free to join our <a href="https://discord.gg/JDBeZYK">forum</a>.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            airctic.com
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.2d1db4bd.min.js"></script>
      <script src="../assets/javascripts/bundle.6627ddf3.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://unpkg.com/mermaid@8.4.6/dist/mermaid.min.js"></script>
      
        <script src="../js/termynal.js"></script>
      
        <script src="../js/custom.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/@widgetbot/crate@3"></script>
      
        <script src="../js/crate.js"></script>
      
    
  </body>
</html>