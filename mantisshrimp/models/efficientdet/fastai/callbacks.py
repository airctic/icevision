__all__ = ["EfficientDetCallback"]

try:
    from mantisshrimp.engines.fastai import *
except ImportError:
    pass


class EfficientDetCallback(fastai.Callback):
    def begin_batch(self):
        assert len(self.xb) == len(self.yb) == 1, "Only works for single input-output"
        self.learn.xb = (self.xb[0], self.yb[0])
        self.learn.yb = ()

    def after_pred(self):
        self.learn.yb = [self.learn.xb[1]]
        self.learn.xb = [self.learn.xb[0]]
